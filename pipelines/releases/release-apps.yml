name: release-apps

resources:
    pipelines:
    - pipeline: dropClient
      source: Jabdel4.TodoApp.Build.Client
      trigger: true # To trigger a run when any run of the referenced pipeline completes    
    - pipeline: dropApi
      source: Jabdel4.TodoApp.Build.Api
      trigger: true # To trigger a run when any run of the referenced pipeline completes
    
trigger: none

variables:
- template: ../variables/variables.yml
- group: serviceConnections

stages:
- stage: dev
  condition: eq(variables['System.debug'], true)
  jobs:
  - template: ../templates/release-apps-template.yml
    parameters:
        env: 'dev'
- stage: qa
  dependsOn: dev
  condition: and(succeeded(), eq(variables['System.debug'], true))
  jobs:
  - template: ../templates/release-apps-template.yml
    parameters:
        env: 'qa'
- stage: prod
  dependsOn:
  - dev
  - qa
  condition: and(succeeded(), eq(variables['System.debug'], true))
  jobs:
  - template: ../templates/release-apps-template.yml
    parameters:
        env: 'prod'
