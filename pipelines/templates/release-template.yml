parameters:
- name: azServiceConnection
  type: string
  default: ''

stages:
- stage: RESOURCES
  jobs:
  - job: Infra
    displayName: 'Azure Provisioning'
    steps:
        - task: AzureResourceManagerTemplateDeployment@3
          inputs:
            deploymentScope: "Resource Group"
            azureResourceManagerConnection: "${{ parameters.azServiceConnection }}"
            action: "Create Or Update Resource Group"
            resourceGroupName: "$(resourceGroupName)"
            location: "$(location)"
            templateLocation: "Linked artifact"
            csmFile: "$(templateFilePath)"
            csmParametersFile: "$(templateParametersFilePath)"
            deploymentMode: "Incremental"
            deploymentName: "DeployPipelineTemplate"
- stage: APP
  condition: onSucceeded('RESOURCES')
  jobs:
  - job: API
    displayName: 'Deploy the API'
    steps:
        - task:
  - job: CLIENT
    displayName: 'Deploy the Client'
    steps:
      - task:
      